<?php
// Fake user data for portfolio
$full_name = "Sarah Nicole";
$user_id = 1;
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookWise Dashboard</title>
    <link rel="stylesheet" href="Dashboard.css">
    <link rel="stylesheet" href="pop_up_message.css">
    <link rel="stylesheet" href="pc_panels.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>



        .borrow_table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-left: -10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        /* Styling for table headers */
        .borrow_table th {
            background-color: white;
            border-bottom: 1px solid black;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center; /* Center the header text */
            padding: 12px 10px;
        }

        /* Styling for table cells */
        .borrow_table td {
            color: #555;
            padding: 12px 15px;
            text-align: center; /* Center text horizontally */
            vertical-align: middle; /* Center text vertically */
        }

        /* Even row styling */
        .borrow_table tr:nth-child(even) {
            background-color: #fff;
        }

        /* Hover effect */
        .borrow_table tr:hover {
            background-color: #f1f1f1;
        }

        /* Responsive design for smaller screens */
        @media screen and (max-width: 768px) {
            .borrow_table th,
            .borrow_table td {
                padding: 8px;
                font-size: 14px;
            }

            .borrow_table {
                font-size: 14px;
                width: 100%;
                overflow-x: auto;
                display: block;
            }
        }

        /* Additional container styling */
        .borrow_table-container {
            margin-top: 30px;
        }
        /* Buttons with icons */
        .icon-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: black;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px; /* Curve sides */
            cursor: pointer;
            font-size: 14px;
            margin-left: -5px;
        }

        .icon-button img {
            width: 16px;
            height: 16px;
        }

        .icon-button i {
            font-size: 16px;
        }

        /* On hover, button changes color */
        .icon-button:hover {
            background-color: #333;
        }



        .toolbar {
            display: flex;
            align-items: center;
            gap: 10px; /* Add spacing between all items */
            padding: 10px;
        }
        .action-buttons button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
        }
        .filter-icon {
            margin-left: 20px; /* Add space between action buttons and the filter button */
        }
        .search-bar input {
            padding: 5px 10px;
            width: 200px; /* Adjust width as needed */
        }
        #borrowButton {
            border-radius: 20px 0 0 20px; /* Curve only the left side */
        }
        #returnButton {
            border-radius: 0 20px 20px 0; /* Curve only the right side */
        }

        .action-button img {
            width: 16px; /* Set the desired width */
            height: 16px; /* Set the desired height */
            margin-right: 10px;
        }


        /* Modal background */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        /* Modal content */
        .modal-content {
            background-color: #ffffff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.3s ease-in-out;
        }

        /* Close button */
        .close {
            color: #aaa;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
        }

        /* Form styling */
        .modal-content .form-group {
            margin-bottom: 15px;
        }

        .modal-content label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .modal-content input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .modal-content .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }



        /* Animation for modal */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #acquireModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }
        .modal-content table {
            width: 100%;
            border-collapse: collapse;
        }
        .modal-content th, .modal-content td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }


    </style>
</head>
<body>
<div class="sidebar">
    <div class="logo">
        <img src="BOOKWISE.png" alt="Logo">
    </div>
    <nav>
        <ul>
            <li><a href="#" onclick="changeContent('home')"><img src="images/dashboard.png" alt="Home"></a></li>
            <li><a href="#" onclick="changeContent('borrowed')"><img src="images/borrow%20(1).png" alt="Borrowed Books"></a></li>
            <li><a href="#" onclick="changeContent('returned')"><img src="images/book_dash.png" alt="Returned Books"></a></li>
            <li><a href="#" onclick="changeContent('study')"><img src="images/studyspace_dash.png" alt="Study Space"></a></li>
            <li><a class="logout" href="#"><img src="images/logout.png" alt="Logout"></a></li>
        </ul>
    </nav>
</div>

<div class="main-content">
    <header>
        <div class="user-info">
            <img src="images/user%201.png" alt="User Icon" class="user-icon">

            <div class="user-details">
                <span class="username"><strong><?php echo $full_name; ?></strong></span> <!-- Dynamic username -->
                <span class="role">User</span>
            </div>
        </div>
        <div class="time-date">
            <span class="time" id="time"></span>
            <span class="date" id="date"></span>
        </div>
        <div class="setting">
            <img src="images/setting-2%202.png" alt="Settings Icon" class="user-icon">
        </div>
    </header>

    <section class="dashboard" id="dashboard-content">
        <!-- Default Content -->
        <div id="home-content">
            <div class="panel-container">

                <div class="panel">
                    <img src="images/book_.png" alt="Icon 2">
                    <div class="divider"></div>
                    <span class="panel-text">Your Borrowed<br>
                                            Book List</span>
                </div>
                <div class="panel">
                    <img src="images/back.png" alt="Icon 3">
                    <div class="divider"></div>
                    <span class="panel-text">Your Returned<br>
                                            Book List</span>
                </div>
                <div class="panel">
                    <img src="images/laptop.png" alt="Icon 4">
                    <div class="divider"></div>
                    <span class="panel-text">Reserve Study<br>
Space</span>
                </div>
            </div>
            <div class="panel-logo-container">
                <div class="panel row2">
                    <img src="images/hand.png" alt="Icon 4">
                    <div class="divider"></div>
                    <span class="panel-text">Let's browse available book<br> inventory</span>
                </div>
                <div class="center-logo">
                    <img src="images/Group%206.png" alt="Centered Logo">
                </div>

            </div>

            <div class="quote-panel">
                <p class="quote-text">
                    "A library is not a luxury but one of the necessities of life. Within its walls, all ideas exist together,
                    endless worlds waiting to be discovered, and stories waiting to be lived. In a world of noise,
                    it’s a sanctuary of quiet wisdom, a place where anyone can find the key to any door."
                </p>
                <p class="letter">
                    -BookWise Team
                </p>

            </div>


        </div>
        <div class="chart">
            <canvas id="myPieChart"></canvas>
            <div class="legend-panel" id="legend-panel">
                <div class="panel legend_image">
                    <img src="images/2%208.png" alt="Icon 4">
                    <div class="divider"></div>
                    <div><span class="legend-color" style="background-color: #3D3E3E;"></span> Borrowed Books</div>
                    <div><span class="legend-color" style="background-color: #151619;"></span> Returned Books</div>
                </div>
            </div>
        </div>

    </section>
</div>

<div id="return_book_Modal" class="modal">
    <div class="modal-content">
        <h2>Book Details</h2>
        <label for="bookTitle">Title:</label>
        <input type="text" id="bookTitle" readonly />

        <label for="bookAuthor">Author:</label>
        <input type="text" id="bookAuthor" readonly />

        <label for="bookCategory">Category:</label>
        <input type="text" id="bookCategory" readonly />

        <label for="bookISBN">ISBN:</label>
        <input type="text" id="bookISBN" readonly />

        <label for="bookPubYr">Publication Year:</label>
        <input type="text" id="bookPubYr" readonly />

        <label for="borrow_date">Borrow Date:</label>
        <input type="text" id="borrow_date" readonly />

        <label for="due_date">Due Date:</label>
        <input type="text" id="due_date" readonly />

        <label for="return_date">Return Date:</label>
        <input type="text" id="return_date" readonly />

        <label for="penalty">Penalty:</label>
        <input type="text" id="penalty" readonly />

        <div class="modal-buttons">
            <button id="reserveBtn" onclick="openReservationModal()">Reserve</button>
            <button id="cancelBtn" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="acquireModal" style="display: none;">
    <div class="modal-content">
        <h2>Confirm Reservation</h2>
        <table id="selectedBooksTable">
            <thead>
            <tr>
                <th>Book ID</th>
                <th>Title</th>
                <th>Due Date</th>
            </tr>
            </thead>
            <tbody>
            <!-- Selected books will be dynamically added here -->
            </tbody>
        </table>
        <div>
            <button onclick="confirmReservation()">Confirm</button>
            <button onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>



<?php
// Fake data for portfolio - no database needed
$borrowedCount = 5;
$returnedCount = 12;
?>


<script>

    // Initialize on page load
    updateTimeDate();
    loadPieChart();
    
    function updateTimeDate() {
        const now = new Date();
        const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
        const dateOptions = { year: 'numeric', month: 'short', day: '2-digit' };

        const timeEl = document.getElementById('time');
        const dateEl = document.getElementById('date');
        
        if (timeEl) timeEl.textContent = now.toLocaleTimeString([], timeOptions);
        if (dateEl) dateEl.textContent = now.toLocaleDateString([], dateOptions);
    }

    setInterval(updateTimeDate, 1000);

    function loadPieChart() {
        // JavaScript code to render the pie chart
        const borrowedCount = <?php echo $borrowedCount; ?>;
        const returnedCount = <?php echo $returnedCount; ?>;

        const ctx = document.getElementById('myPieChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Borrowed Books', 'Returned Books'],
                datasets: [{
                    data: [borrowedCount, returnedCount],
                    backgroundColor: ['#3D3E3E', '#151619'],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false // Hide built-in legend
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const label = context.label || '';
                                const count = context.raw || 0;
                                return `${label}: ${count}`;
                            }
                        }
                    }
                }
            }
        });
    }


    function changeContent(content) {
        const dashboardContent = document.getElementById('dashboard-content');

        // Clear existing content
        dashboardContent.innerHTML = '';

        // Change content based on the clicked icon
        if (content === 'home') {
            dashboardContent.innerHTML = `
            <section class="dashboard" id="dashboard-content" style="margin-top: -55px">
                <!-- Default Content -->
                <div id="home-content">
                    <div class="panel-container">
                        <div class="panel">
                            <img src="images/book_.png" alt="Icon 2">
                            <div class="divider"></div>
                            <span class="panel-text">Your Borrowed<br>Book List</span>
                        </div>
                        <div class="panel">
                            <img src="images/back.png" alt="Icon 3">
                            <div class="divider"></div>
                            <span class="panel-text">Your Returned<br>Book List</span>
                        </div>
                        <div class="panel">
                            <img src="images/laptop.png" alt="Icon 4">
                            <div class="divider"></div>
                            <span class="panel-text">Reserve Study<br>Space</span>
                        </div>
                    </div>
                    <div class="panel-logo-container">
                        <div class="panel row2">
                            <img src="images/hand.png" alt="Icon 4">
                            <div class="divider"></div>
                            <span class="panel-text">Let's browse available book<br> inventory</span>
                        </div>
                        <div class="center-logo">
                            <img src="images/Group%206.png" alt="Centered Logo">
                        </div>
                    </div>
                    <div class="quote-panel">
                        <p class="quote-text" style="text-align: center;">
                            "A library is not a luxury but one of the necessities of life. Within its walls, all ideas exist together,
                            endless worlds waiting to be discovered, and stories waiting to be lived. In a world of noise,
                            it’s a sanctuary of quiet wisdom, a place where anyone can find the key to any door."
                        </p>
                        <p class="letter" style="text-align: center;">
                            -BookWise Team
                        </p>
                    </div>
                </div>
                <div class="chart">
                    <canvas id="myPieChart"></canvas>
                    <div class="legend-panel" id="legend-panel">
                        <div class="panel legend_image">
                            <img src="images/2%208.png" alt="Icon 4">
                            <div class="divider"></div>
                            <div><span class="legend-color" style="background-color: #3D3E3E;"></span> Borrowed Books</div>
                            <div><span class="legend-color" style="background-color: #151619;"></span> Returned Books</div>
                        </div>
                    </div>
                </div>
            </section>
        `;
            loadPieChart();
        } else if (content === 'borrowed') {
            borrowed_books();
        } else if (content === 'returned') {
            fetch_book();
        } else if (content === 'study') {
            dashboardContent.innerHTML = `
                    <div class="toolbar">
                         <div class="action-buttons">
                                <button
                                    id="borrowButton"
                                    style="background-color:white; color: black; border-radius: 20px 0 0 20px;"
                                    onclick="toggleButtonColor(this);fetchAndDisplayBooks()">
                                    Borrowed Books
                                </button>
                                <button
                                    id="returnButton"
                                    style="background-color:  black; color: white; border-radius: 0 20px 20px 0;"
                                    onclick="toggleButtonColor(this);fetchAndDisplayStudySpace()">
                                    Return Books
                                </button>
                            </div>

                        <div class="filter-icon" style="margin-left: 500px;">
                            <button onclick="acquire()" class="icon-button">
                                <img src="images/add-circle%201.png" alt="Add Icon"> Acquire
                            </button>
                        </div>

                        <div class="filter-icon" style="margin-left: 10px;">
                            <button onclick="showFilterOptions()" class="icon-button">
                                <i class="fa fa-filter"></i> Filter
                            </button>
                        </div>

                        <div class="search-bar">
                            <input type="text" id="searchInput" placeholder="Search by Title or Author" onkeyup="filterTable()">
                        </div>
                    </div>
                `;
            fetchAndDisplayBooks();
        } else if (content === 'logout') {
            dashboardContent.innerHTML = `
                <div>
                    <h2>Logout</h2>
                    <p>You have successfully logged out.</p>
                </div>`;
        }
    }
    function toggleButtonColor(clickedButton) {
        // Get all buttons in the "action-buttons" div
        const buttons = document.querySelectorAll(".action-buttons button");

        // Loop through each button
        buttons.forEach(button => {
            if (button === clickedButton) {
                // Set the clicked button to white
                button.style.backgroundColor = "white";
                button.style.color = "black";
            } else {
                // Reset the other buttons to black
                button.style.backgroundColor = "black";
                button.style.color = "white";
            }
        });
    }

    function return_book(){
        const dashboardContent = document.getElementById('dashboard-content');

        // Clear existing content
        dashboardContent.innerHTML = '';
        
        // Fake data for portfolio
        const data = [
            {Borrowing_ID: 1, Book_ID: 201, Title: "Moby Dick", Author: "Herman Melville", Return_Date: "2025-12-15"},
            {Borrowing_ID: 2, Book_ID: 202, Title: "War and Peace", Author: "Leo Tolstoy", Return_Date: "2025-12-18"},
            {Borrowing_ID: 3, Book_ID: 203, Title: "The Odyssey", Author: "Homer", Return_Date: "2025-12-20"},
            {Borrowing_ID: 4, Book_ID: 204, Title: "Crime and Punishment", Author: "Fyodor Dostoevsky", Return_Date: "2025-12-22"},
            {Borrowing_ID: 5, Book_ID: 205, Title: "Jane Eyre", Author: "Charlotte Bronte", Return_Date: "2025-12-25"},
            {Borrowing_ID: 6, Book_ID: 206, Title: "Wuthering Heights", Author: "Emily Bronte", Return_Date: "2025-12-28"}
        ];
        
        {
                if (data.length > 0) {
                    let tableContent = `
                       <div class="toolbar">
                            <div class="action-buttons">
                                <button
                                    id="borrowButton"
                                    style="background-color: black; color: white; border-radius: 20px 0 0 20px;"
                                    onclick="toggleButtonColor(this);borrowed_books()">
                                    Borrowed Books
                                </button>
                                <button
                                    id="returnButton"
                                    style="background-color: white; color: black; border-radius: 0 20px 20px 0;"
                                    onclick="toggleButtonColor(this);return_book()">
                                    Return Books
                                </button>
                            </div>

                            <div class="filter-icon" style="margin-left: 700px;">
                                <button onclick="showFilterOptions()">Filter <i class="fa fa-filter"></i></button>
                            </div>

                            <div class="search-bar">
                                <input type="text" id="searchInput" placeholder="Search by Title or Author" onkeyup="filterTable()">
                            </div>
                        </div>

                        <table class="borrow_table" style="margin-top: -15px">
                            <thead>
                                <tr>
                                    <th>BRW ID</th>
                                    <th>Book ID</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Return Date</th>
                                    <th>Action</th>

                                </tr>
                            </thead>
                            <tbody>`;
                    data.forEach(book => {
                        tableContent += `
                            <tr>
                                <td>${book.Borrowing_ID}</td>
                                <td>${book.Book_ID}</td>
                                <td>${book.Title}</td>
                                <td>${book.Author}</td>
                                <td>${book.Return_Date}</td>
                                <td>
                                    <div class="action-button" onclick="openModal(${book.Book_ID})">
                                        <img src="images/btn%20view.png" alt="View Details Icon">
                                    </div>
                                </td>
                            </tr>
                        `;
                    });

                    tableContent += `</tbody></table>`;
                    document.getElementById('dashboard-content').innerHTML = tableContent;
                } else {
                    document.getElementById('dashboard-content').innerHTML = "No borrowed books found.";
                }
            }
    }


    // Open modal
    function openModal(bookID) {
        console.log('Requested Book ID:', bookID);

        // Fake book details data
        const bookDetails = {
            201: {Title: "Moby Dick", Author: "Herman Melville", Category: "Classic Fiction", ISBN: "978-1503280786", Publication_Year: 1851, Borrow_Date: "2025-12-01", Due_Date: "2025-12-15", Return_Date: "2025-12-15", Penalty_Amount: "$0.00"},
            202: {Title: "War and Peace", Author: "Leo Tolstoy", Category: "Historical Fiction", ISBN: "978-1400079988", Publication_Year: 1869, Borrow_Date: "2025-12-04", Due_Date: "2025-12-18", Return_Date: "2025-12-18", Penalty_Amount: "$0.00"},
            203: {Title: "The Odyssey", Author: "Homer", Category: "Epic Poetry", ISBN: "978-0140268867", Publication_Year: -800, Borrow_Date: "2025-12-06", Due_Date: "2025-12-20", Return_Date: "2025-12-20", Penalty_Amount: "$0.00"},
            204: {Title: "Crime and Punishment", Author: "Fyodor Dostoevsky", Category: "Psychological Fiction", ISBN: "978-0486415871", Publication_Year: 1866, Borrow_Date: "2025-12-08", Due_Date: "2025-12-22", Return_Date: "2025-12-24", Penalty_Amount: "$5.00"},
            205: {Title: "Jane Eyre", Author: "Charlotte Bronte", Category: "Gothic Fiction", ISBN: "978-0141441146", Publication_Year: 1847, Borrow_Date: "2025-12-11", Due_Date: "2025-12-25", Return_Date: "2025-12-25", Penalty_Amount: "$0.00"},
            206: {Title: "Wuthering Heights", Author: "Emily Bronte", Category: "Gothic Fiction", ISBN: "978-0141439556", Publication_Year: 1847, Borrow_Date: "2025-12-14", Due_Date: "2025-12-28", Return_Date: "2025-12-28", Penalty_Amount: "$0.00"}
        };
        
        const book = bookDetails[bookID];
        
        {
                console.log("Response from PHP (Book details):", book); // Log the response from PHP

                if (book.error) {
                    console.error("Error:", book.error);  // Log the error if no book details were found
                } else {
                    document.getElementById('bookTitle').value = book.Title;
                    document.getElementById('bookAuthor').value = book.Author;
                    document.getElementById('bookCategory').value = book.Category;
                    document.getElementById('bookISBN').value = book.ISBN;
                    document.getElementById('bookPubYr').value = book.Publication_Year;
                    document.getElementById('borrow_date').value = book.Borrow_Date;
                    document.getElementById('due_date').value = book.Due_Date;
                    document.getElementById('return_date').value = book.Return_Date;
                    document.getElementById('penalty').value = book.Penalty_Amount;

                    document.getElementById('return_book_Modal').style.display = 'block';
                }
            }
    }

    // Close modal
    function closeModal() {
        document.getElementById("return_book_Modal").style.display = "none";
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById("return_book_Modal");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };

    function borrowed_books(){
        const dashboardContent = document.getElementById('dashboard-content');

        // Clear existing content
        dashboardContent.innerHTML = '';
        
        // Fake data for portfolio
        const data = [
            {Reservation_ID: 1, Book_ID: 101, Title: "To Kill a Mockingbird", Author: "Harper Lee", Reservation_Date: "2026-01-05", due_date: "2026-01-19"},
            {Reservation_ID: 2, Book_ID: 102, Title: "1984", Author: "George Orwell", Reservation_Date: "2026-01-06", due_date: "2026-01-20"},
            {Reservation_ID: 3, Book_ID: 103, Title: "The Great Gatsby", Author: "F. Scott Fitzgerald", Reservation_Date: "2026-01-07", due_date: "2026-01-21"},
            {Reservation_ID: 4, Book_ID: 104, Title: "Pride and Prejudice", Author: "Jane Austen", Reservation_Date: "2026-01-08", due_date: "2026-01-22"},
            {Reservation_ID: 5, Book_ID: 105, Title: "The Catcher in the Rye", Author: "J.D. Salinger", Reservation_Date: "2026-01-09", due_date: "2026-01-23"}
        ];
        
        {
                if (data.length > 0) {
                    let tableContent = `
                       <div class="toolbar">
                            <div class="action-buttons">
                                <button
                                    id="borrowButton"
                                    style="background-color: white; color: black; border-radius: 20px 0 0 20px;"
                                    onclick="toggleButtonColor(this)">
                                    Borrowed Books
                                </button>
                                <button
                                    id="returnButton"
                                    style="background-color: black; color: white; border-radius: 0 20px 20px 0;"
                                    onclick="toggleButtonColor(this);return_book()">
                                    Return Books
                                </button>
                            </div>

                            <div class="filter-icon" style="margin-left: 700px;">
                                <button onclick="showFilterOptions()">Filter <i class="fa fa-filter"></i></button>
                            </div>

                            <div class="search-bar">
                                <input type="text" id="searchInput" placeholder="Search by Title or Author" onkeyup="filterTable()">
                            </div>
                        </div>

                        <table class="borrow_table" style="margin-top: -15px">
                            <thead>
                                <tr>
                                    <th>RSV ID</th>
                                    <th>Book ID</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>RSV Date</th>
                                    <th>Due Date</th>

                                </tr>
                            </thead>
                            <tbody>`;
                    data.forEach(book => {
                        tableContent += `
                            <tr>
                                <td>${book.Reservation_ID}</td>
                                <td>${book.Book_ID}</td>
                                <td>${book.Title}</td>
                                <td>${book.Author}</td>
                                <td>${book.Reservation_Date}</td>
                                <td>${book.due_date}</td>



                            </tr>`;
                    });
                    tableContent += `</tbody></table>`;
                    document.getElementById('dashboard-content').innerHTML = tableContent;
                } else {
                    document.getElementById('dashboard-content').innerHTML = "No borrowed books found.";
                }
            }
    }
    function fetch_book(){
        // Fake data for portfolio
        const data = [
            {Book_ID: 301, Title: "The Hobbit", Author: "J.R.R. Tolkien", ISBN: "978-0547928227", Publication_Year: 1937},
            {Book_ID: 302, Title: "Harry Potter and the Sorcerer's Stone", Author: "J.K. Rowling", ISBN: "978-0439708180", Publication_Year: 1997},
            {Book_ID: 303, Title: "The Lord of the Rings", Author: "J.R.R. Tolkien", ISBN: "978-0544003415", Publication_Year: 1954},
            {Book_ID: 304, Title: "The Chronicles of Narnia", Author: "C.S. Lewis", ISBN: "978-0066238500", Publication_Year: 1950},
            {Book_ID: 305, Title: "Brave New World", Author: "Aldous Huxley", ISBN: "978-0060850524", Publication_Year: 1932},
            {Book_ID: 306, Title: "Animal Farm", Author: "George Orwell", ISBN: "978-0452284244", Publication_Year: 1945},
            {Book_ID: 307, Title: "Fahrenheit 451", Author: "Ray Bradbury", ISBN: "978-1451673319", Publication_Year: 1953},
            {Book_ID: 308, Title: "The Hunger Games", Author: "Suzanne Collins", ISBN: "978-0439023481", Publication_Year: 2008}
        ];
        
        {
                if (data.length > 0) {
                    let tableContent = `
                       <div class="toolbar">
                            <div class="action-buttons">
                                <h1>Library Books</h1>
                            </div>

                            <div class="filter-icon" style="margin-left: 700px;">
                                <button onclick="acquire()" class="icon-button">
                                    <img src="images/add-circle%201.png" alt="Add Icon"> Acquire
                                </button>
                            </div>

                            <div class="filter-icon" style="margin-left: 10px;">
                                <button onclick="showFilterOptions()" class="icon-button">
                                    <i class="fa fa-filter"></i> Filter
                                </button>
                            </div>

                            <div class="search-bar">
                                <input type="text" id="searchInput" placeholder="Search by Title or Author" onkeyup="filterTable()">
                            </div>
                        </div>


                        <table class="borrow_table" style="margin-top: -55px">
                            <thead>
                                <tr>

                                    <th>Book ID</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>ISBN</th>
                                    <th>Pub date</th>
                                    <th>Action</th>

                                </tr>
                            </thead>
                            <tbody>`;
                    data.forEach(book => {
                        tableContent += `
                           <tr>
                                <td>${book.Book_ID}</td>
                                <td>${book.Title}</td>
                                <td>${book.Author}</td>
                                <td>${book.ISBN}</td>
                                <td>${book.Publication_Year}</td>
                                <td>
                                    <!-- Visible checkbox -->
                                    <input type="checkbox" id="check-${book.Book_ID}">
                                </td>
                            </tr>`;
                    });
                    tableContent += `</tbody></table>`;
                    document.getElementById('dashboard-content').innerHTML = tableContent;
                } else {
                    document.getElementById('dashboard-content').innerHTML = "No borrowed books found.";
                }
            }

    }
    function acquire() {
        // Get all checked items
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        const tableBody = document.getElementById("selectedBooksTable").querySelector("tbody");
        tableBody.innerHTML = ""; // Clear existing rows in the modal

        // Get today's date in the format YYYY-MM-DD
        const today = new Date().toISOString().split("T")[0];

        // Loop through checked checkboxes
        checkboxes.forEach((checkbox) => {
            const row = checkbox.closest("tr");
            const bookId = row.children[0].innerText; // Book ID
            const title = row.children[1].innerText; // Title

            // Create a new row in the modal table
            const newRow = document.createElement("tr");
            newRow.innerHTML = `
            <td>${bookId}</td>
            <td>${title}</td>
            <td><input type="date" class="due-date" min="${today}"></td>
        `;
            tableBody.appendChild(newRow);
        });

        // Show the modal
        document.getElementById("acquireModal").style.display = "block";
    }

    function closeModal() {
        // Hide the modal
        document.getElementById("acquireModal").style.display = "none";
        uncheckReservedBooks();
    }

    function confirmReservation() {
        const rows = document.getElementById("selectedBooksTable").querySelectorAll("tbody tr");
        const userId = 1; // Fake user ID for portfolio
        const loanDate = new Date().toISOString().split("T")[0];

        let allDatesValid = true;
        
        rows.forEach((row) => {
            const dueDateInput = row.querySelector(".due-date");
            const dueDate = dueDateInput.value;

            if (!dueDate) {
                showPopup("Please select a due date for all books.", "error");
                allDatesValid = false;
                return;
            }
        });

        if (!allDatesValid) return;

        // Simulate successful reservation (no backend needed)
        console.log("Reservation confirmed (portfolio demo)");
        showPopup("Reservation confirmed!", "success");
        
        // Uncheck the checkboxes
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        checkboxes.forEach((checkbox) => {
            checkbox.checked = false;
        });
        
        closeModal();

    }
    function showPopup(message, type) {
        const popup = document.createElement("div");
        popup.className = `popup-message ${type}`;
        popup.innerText = message;

        document.body.appendChild(popup);

        // Automatically remove the popup after 3 seconds
        setTimeout(() => {
            popup.remove();
        }, 3000);
    }
    function uncheckReservedBooks() {
        // Get all checked checkboxes
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

        // Uncheck each checkbox
        checkboxes.forEach((checkbox) => {
            checkbox.checked = false;
        });
    }
    function fetchAndDisplayBooks() {
        const dashboardContent = document.getElementById('dashboard-content');

        dashboardContent.innerHTML = '';
        dashboardContent.innerHTML = `
                    <div class="toolbar">
                         <div class="action-buttons">
                                <button
                                    id="borrowButton"
                                    style="background-color:white; color: black; border-radius: 20px 0 0 20px;"
                                    onclick="toggleButtonColor(this);fetchAndDisplayBooks()">
                                    Borrowed Books
                                </button>
                                <button
                                    id="returnButton"
                                    style="background-color:  black; color: white; border-radius: 0 20px 20px 0;"
                                    onclick="toggleButtonColor(this);fetchAndDisplayStudySpace()">
                                    Return Books
                                </button>
                            </div>

                        <div class="filter-icon" style="margin-left: 500px;">
                            <button onclick="acquire()" class="icon-button">
                                <img src="images/add-circle%201.png" alt="Add Icon"> Reservations
                            </button>
                        </div>

                        <div class="filter-icon" style="margin-left: 10px;">
                            <button onclick="showFilterOptions()" class="icon-button">
                                <i class="fa fa-filter"></i> Filter
                            </button>
                        </div>

                        <div class="search-bar">
                            <input type="text" id="searchInput" placeholder="Search by Title or Author" onkeyup="filterTable()">
                        </div>
                    </div>
                `;
        
        // Fake study space data
        const books = [
            {Image_URL: 'images/laptop.png', Location: 'Study Room A', Space_Type: 'Private', Book_ID: 401},
            {Image_URL: 'images/laptop.png', Location: 'Study Room B', Space_Type: 'Private', Book_ID: 402},
            {Image_URL: 'images/laptop.png', Location: 'Study Room C', Space_Type: 'Group', Book_ID: 403},
            {Image_URL: 'images/laptop.png', Location: 'Study Room D', Space_Type: 'Group', Book_ID: 404},
            {Image_URL: 'images/laptop.png', Location: 'Computer Lab 1', Space_Type: 'Computer', Book_ID: 405},
            {Image_URL: 'images/laptop.png', Location: 'Computer Lab 2', Space_Type: 'Computer', Book_ID: 406}
        ];
        
        {
                if (Array.isArray(books)) {
                    console.log(books);  // Check the structure of the response
                    renderBookPanels(books);
                } else {
                    console.error('Unexpected data format:', books);
                }
            }
    }



    function fetchAndDisplayStudySpace() {
        const dashboardContent = document.getElementById('dashboard-content');

        dashboardContent.innerHTML = '';
        dashboardContent.innerHTML = `
                    <div class="toolbar">
                         <div class="action-buttons">
                                <button
                                    id="borrowButton"
                                    style="background-color:black; color: white; border-radius: 20px 0 0 20px;"
                                    onclick="toggleButtonColor(this);fetchAndDisplayBooks()">
                                    Borrowed Books
                                </button>
                                <button
                                    id="returnButton"
                                    style="background-color: white; color: black;   border-radius: 0 20px 20px 0;"
                                    onclick="toggleButtonColor(this);fetchAndDisplayStudySpace()">
                                    Return Books
                                </button>
                            </div>

                        <div class="filter-icon" style="margin-left: 500px;">
                            <button onclick="acquire()" class="icon-button">
                                <img src="images/add-circle%201.png" alt="Add Icon"> Reservations
                            </button>
                        </div>

                        <div class="filter-icon" style="margin-left: 10px;">
                            <button onclick="showFilterOptions()" class="icon-button">
                                <i class="fa fa-filter"></i> Filter
                            </button>
                        </div>

                        <div class="search-bar">
                            <input type="text" id="searchInput" placeholder="Search by Title or Author" onkeyup="filterTable()">
                        </div>
                    </div>
                `;
        
        // Fake returned study space data
        const books = [
            {Image_URL: 'images/laptop.png', Location: 'Study Room E', Space_Type: 'Private - Returned', Book_ID: 501},
            {Image_URL: 'images/laptop.png', Location: 'Study Room F', Space_Type: 'Group - Returned', Book_ID: 502},
            {Image_URL: 'images/laptop.png', Location: 'Computer Lab 3', Space_Type: 'Computer - Returned', Book_ID: 503}
        ];
        
        {
                if (Array.isArray(books)) {
                    console.log(books);  // Check the structure of the response
                    renderBookPanels(books);
                } else {
                    console.error('Unexpected data format:', books);
                }
            }
    }

    function renderBookPanels(books) {
        const container = document.getElementById('dashboard-content');
        //container.innerHTML = ''; // Clear existing content

        const bookPanelContainer = document.createElement('div');
        bookPanelContainer.className = 'book-panel-container';  // Apply the specific class for the book panels

        books.forEach(book => {
            const bookPanel = createBookPanel(book);
            bookPanelContainer.appendChild(bookPanel);
        });

        container.appendChild(bookPanelContainer);  // Append the book panels container to the dashboard content
    }

    function createBookPanel(book) {
        const bookPanel = document.createElement('div');
        bookPanel.className = 'book-panel';

        const bookImage = document.createElement('img');
        bookImage.src = book.Image_URL || 'images/laptop.png'; // Fallback if no image is available
        bookImage.alt = 'Book Image';
        bookImage.className = 'book-image';

        const divider = document.createElement('div');
        divider.className = 'divider';

        const bookInfo = document.createElement('div');
        bookInfo.className = 'book-info';
        const bookTitle = book.Location || "No Title Available";  // Fallback title if not available
        bookInfo.innerHTML = `<h3>${bookTitle}</h3><p>${book.Space_Type}</p>`; // Corrected line

        // Create the layout and append elements
        bookPanel.appendChild(bookImage);
        bookPanel.appendChild(divider);
        bookPanel.appendChild(bookInfo);

        // Make the whole panel clickable
        bookPanel.onclick = () => openModal(book.Book_ID); // Assuming Book_ID is correct in the data

        return bookPanel;
    }




</script>
</body>
</html>